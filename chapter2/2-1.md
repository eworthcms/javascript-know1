# 词法阶段

为什么叫词法作用域？

编译的第一个阶段是 “分词/词法阶段” Tokenizing/Lexing，也叫词法化（单词化）。词法化的过程会对源代码中的字符进行检查，如果是有状态的解析过程，还会赋予单词语义。



**词法作用域就是定义在词法阶段的作用域**。换句话说，词法作用域是由你在写代码时将变量和块作用域写在哪里来决定的，因此当词法分析器处理代码时会保持作用域不变。 => 定义时的作用域



```javascript
function foo(a){
    var b = a * 2;
    
    function bar(c){
        console.log(a,b,c);
    }
    bar(b * 3);
}

foo(2);  //2,4,12
```

![作用域](http://s.i9u.cc/Snip20190126_1.png)



1⃣️ 包含在全局作用域，只有一个标识符 foo

2⃣️ 包含在foo创建的作用域，有三个标识符 a b bar

3⃣️ 包含在bar创建的作用域，只有一个标识符 c



## 查找

引擎通过嵌套作用域的关系来查找标识符的位置。=> 作用域链

作用域查找会在找到第一个匹配的标识符时停止。在多层的嵌套作用域中可以定义同名的标识符，内层的标识符屏蔽了外层的标识符。如果内层没有找到，则会沿着作用域链从内层逐级往外查找，直到遇到第一个匹配的标识符为止。



全局变量会自动成为全局对象（window）的属性，所以可以间接的使用 window.a 对其进行访问，可以规避那些被同名变量屏蔽的全局变量。

```javascript
var a = 1;  //window.a = 1

function myMethod(a){
    a  //局部变量
    window.a  //全局变量
}
```



无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由 **函数被声明** 时所处的位置决定。

词法作用域查找只会查找一级标识符，比如a、b和c。如果代码中引用了 foo.bar.baz，词法作用域查找只会试图查找 foo 标识符，找到这个变量后，对象属性访问规则会分别接管对 bar 和 baz 属性的访问。

















